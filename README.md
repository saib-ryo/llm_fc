# LLMアプリケーション解説
- 旅行者にとってリアルな条件を考慮した多様で実用的な旅行プランを提供するアプリケーション

## 機能
このアプリケーションは旅行計画を支援するLLMベースのツールです。ユーザー入力から旅行先、日程、ホテル情報を抽出し、以下を行います：
- **旅行日程の抽出**（到着・出発日時、滞在日数）
- **ホテル候補の推定・重複排除・距離計算**
- **天気情報の取得**（OpenWeather API）
- **観光スポットやナイトライフ情報の生成**（LLM経由）
- **旅行プラン自動生成**（天気・ホテル・フライト制約を踏まえた提案）

---

## 使用している外部API
- **OpenWeather One Call API**: 指定した場所の週間天気を取得。
- **Open-Meteo Geocoding API**: 地名から緯度・経度を取得。
- **OpenAI Chat Completions API**:  
  - ユーザー入力の解析（location, days, arrival_time, departure_time）  
  - ホテル候補の取得  
  - 観光スポット情報生成  
  - 旅行プラン生成  

---

## 関数の説明
- **haversine(lat1, lon1, lat2, lon2)**  
  緯度・経度から距離を計算する関数。

- **get_hotel_candidates_via_llm(hotel_name, location, …)**  
  LLMを利用し、ホテル名と地域から候補を取得。類似度スコアを返す。

- **deduplicate_hotels(candidates, …)**  
  ホテル候補の重複排除を行う。文字列類似度と座標の閾値を使う。

- **get_coordinates(location: str)**  
  Open-Meteo APIで地名から座標を取得。

- **get_weather(location: str, days: int = 7)**  
  OpenWeather APIを利用し週間天気を返す。

- **get_tourist_spots(location: str, limit: int = 12)**  
  LLMを使って観光スポット・ナイトライフ・料理をJSON形式で返す。

- **main処理**  
  1. ユーザーから旅行内容を入力  
  2. LLMで日程情報を抽出  
  3. ホテル候補をLLMから取得し、重複を排除してユーザーに選択させる  
  4. 天気と観光スポットを取得  
  5. LLMに情報を渡し、旅行プランを生成  

---

## 全体の流れ
1. ユーザーが旅行内容（場所・期間）を入力  
2. ChatGPTが到着日・出発日・滞在日数を抽出  
3. ユーザーが宿泊ホテルを入力し、候補が提示される（距離や類似度でスコアリング）  
4. 天気情報と観光スポットを収集  
5. これらをまとめてLLMに渡し、日ごとのプランを生成  
6. プランには服装アドバイス、午前・午後・夜のアクティビティ、地元料理の提案が含まれる  

---

## プロンプト設定（content例）
旅行プラン生成時の **system プロンプト** では以下を指定：  
- 各Dayの冒頭に天気情報と服装アドバイスを含める  
- 午前・午後・夜の3分割でアクティビティを提案  
- 夜は毎日異なる地元料理を提案  
- 初日は到着時刻以前に活動を入れない  
- 最終日は出発時刻とチェックイン制約を考慮する  
- 宿泊ホテルがある場合は「ホテル出発」「ホテルに戻る」を含める  
- 最後に持ち物リストをまとめる  

---

##　実行例
```
旅行について、場所と期間を入力してください: 2025年10月15日から石垣島5日間
宿泊ホテル名を入力してください: フサキビーチリゾート

候補リスト（類似度＋距離でソート、重複除去後）:
1. フサキビーチリゾート - 沖縄県石垣市宇根2435 (score: 1.0, dist: 0.0km, final: 1.0)
2. アートホテル石垣島 - 沖縄県石垣市大川462 (score: 0.7, dist: 1.92km, final: 0.604)
3. グランヴィリオリゾート石垣島 - 沖縄県石垣市浜崎町3-6 (score: 0.7, dist: 3.76km, final: 0.512)
0. 再入力
番号を選んでください: 1

✅ 選択されたホテル: フサキビーチリゾート - 沖縄県石垣市宇根2435

💡 旅行プラン回答:
 ### 石垣島 5日間の旅行プラン

**宿泊ホテル:** フサキビーチリゾート (沖縄県石垣市宇根2435)

---

#### **Day 1 (10月15日)**
- **天気:** 晴れ / 気温: 28°C
- **服装アドバイス:** サマーウェア（短パン、Tシャツ）、帽子、サングラス

- **ホテル出発**  
- **午前:** 到着後、リゾート内でリラックス（プールやビーチで過ごす）
- **午後:** フサキビーチ周辺を散策し、ビーチでゆったり過ごす
- **夜:** 「居酒屋 さりげなく」で地元料理を堪能（沖縄そばや海ぶどうなど）  
- **ホテルに戻る**  

---

#### **Day 2 (10月16日)**
- **天気:** 晴れ時々曇り / 気温: 27°C
- **服装アドバイス:** 短パン、Tシャツ、ビーチサンダル

- **ホテル出発**  
- **午前:** 川平湾を訪れ、グラスボートで海中を観察
- **午後:** バラス島へ移動し、シュノーケリングを楽しむ
- **夜:** 「Bar WAVE」でカクテルを飲みながら、リラックス  
- **ホテルに戻る**  

---

#### **Day 3 (10月17日)**
- **天気:** 雨時々曇り / 気温: 26°C
- **服装アドバイス:** 雨具を持参（軽いレインコート）、カジュアルな服装

- **ホテル出発**  
- **午前:** 石垣島鍾乳洞を探検
- **午後:** 石垣島博物館を訪れ、歴史や文化を学ぶ
- **夜:** ナイトマーケットで地元料理を楽しみながら、お土産探し  
- **ホテルに戻る**  

---

#### **Day 4 (10月18日)**
- **天気:** 晴れ / 気温: 29°C
- **服装アドバイス:** サマードレスやリラックスした服装

- **ホテル出発**  
- **午前:** 玉取崎展望台で絶景を楽しむ
- **午後:** 白保海岸でビーチアクティビティ（バーベキューや海水浴）
- **夜:** 「石垣島タコス」でボリューム満点のタコスを堪能  
- **ホテルに戻る**  

---

#### **Day 5 (10月19日)**
- **天気:** 曇り / 気温: 27°C
- **服装アドバイス:** カジュアルな服装、軽い羽織りものを持参

- **ホテル出発**  
- **午前:** 平久保崎を訪れ、美しい海岸線を散策
- **午後:** 黒島へ渡り、のどかな風景を楽しむ（時間に注意）
- **夜:** シュノーケルナイトツアーに参加（予約が必要）  
- **ホテルに戻る**  
- **出発準備、翌日早めにチェックアウト**  

---

### **持ち物リスト**
- サマーウェア（Tシャツ、短パン、ビーチサンダル）
- 水着（シュノーケリング用）
- 日焼け止め
- サングラス、帽子
- 雨具（レインコート）
- 着替え（普段着など）
- 飲み物（水、スポーツドリンク）
- カメラ
- 充電器（スマホ、カメラ用）
- お金（現金、クレジットカード）
- ウェットティッシュ
- 旅行保険の確認書類

これで、石垣島での素晴らしい旅行が楽しめます。楽しい旅を！

```

