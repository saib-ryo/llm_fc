# 旅行プランLLMアプリケーション解説
- 旅行者にとってリアルな条件を考慮した多様で実用的な旅行プランを提供するアプリケーション

## 機能
このアプリケーションは旅行計画を支援するLLMベースのツールです。ユーザー入力から旅行先、日程、ホテル情報を抽出し、以下を行います：
- **旅行日程の抽出**（到着・出発日時、滞在日数）
- **ホテル候補の推定・重複排除・距離計算**
- **天気情報の取得**（OpenWeather API）
- **観光スポットやナイトライフ情報の生成**（LLM経由）
- **旅行プラン自動生成**（天気・ホテル・フライト制約を踏まえた提案）

---

## 使用している外部API
- **OpenWeather One Call API**: 指定した場所の週間天気を取得。
- **Open-Meteo Geocoding API**: 地名から緯度・経度を取得。
- **OpenAI Chat Completions API**:  
  - ユーザー入力の解析（location, days, arrival_time, departure_time）  
  - ホテル候補の取得  
  - 観光スポット情報生成  
  - 旅行プラン生成  

---

## 関数の説明
- **haversine(lat1, lon1, lat2, lon2)**  
  緯度・経度から距離を計算する関数。

- **get_hotel_candidates_via_llm(hotel_name, location, …)**  
  LLMを利用し、ホテル名と地域から候補を取得。類似度スコアを返す。

- **deduplicate_hotels(candidates, …)**  
  ホテル候補の重複排除を行う。文字列類似度と座標の閾値を使う。

- **get_coordinates(location: str)**  
  Open-Meteo APIで地名から座標を取得。

- **get_weather(location: str, days: int = 7)**  
  OpenWeather APIを利用し週間天気を返す。

- **get_tourist_spots(location: str, limit: int = 12)**  
  LLMを使って観光スポット・ナイトライフ・料理をJSON形式で返す。

- **main処理**  
  1. ユーザーから旅行内容を入力  
  2. LLMで日程情報を抽出  
  3. ホテル候補をLLMから取得し、重複を排除してユーザーに選択させる  
  4. 天気と観光スポットを取得  
  5. LLMに情報を渡し、旅行プランを生成  

---

## 全体の流れ
1. ユーザーが旅行内容（場所・期間）を入力  
2. ChatGPTが到着日・出発日・滞在日数を抽出  
3. ユーザーが宿泊ホテルを入力し、候補が提示される（距離や類似度でスコアリング）  
4. 天気情報と観光スポットを収集  
5. これらをまとめてLLMに渡し、日ごとのプランを生成  
6. プランには服装アドバイス、午前・午後・夜のアクティビティ、地元料理の提案が含まれる  

---

## プロンプト設定（content例）
旅行プラン生成時の **system プロンプト** では以下を指定：  
- 各Dayの冒頭に天気情報と服装アドバイスを含める  
- 午前・午後・夜の3分割でアクティビティを提案  
- 夜は毎日異なる地元料理を提案  
- 初日は到着時刻以前に活動を入れない  
- 最終日は出発時刻とチェックイン制約を考慮する  
- 宿泊ホテルがある場合は「ホテル出発」「ホテルに戻る」を含める  
- 最後に持ち物リストをまとめる  

---

##　実行例
```
旅行について、場所と期間を入力してください: 2025年10月15日から5日間石垣島
抽出情報: {'location': '石垣島', 'days': 5, 'arrival_time': '2025-10-15T00:00:00', 'departure_time': '2025-10-20T00:00:00'}
宿泊ホテル名を入力してください: フサキビーチリゾート

候補リスト（類似度＋距離でソート、重複除去後）:
1. フサキビーチリゾート - 沖縄県石垣市フサキ239 (score: 1.0, dist: 0.0km, final: 1.0)
2. ホテル日航石垣島 - 沖縄県石垣市真栄里358-1 (score: 0.8, dist: 3.99km, final: 0.6)
3. 石垣シーサイドホテル - 沖縄県石垣市白保1163-1 (score: 0.7, dist: 10.98km, final: 0.151)
0. 再入力
番号を選んでください: 1

✅ 選択されたホテル: フサキビーチリゾート - 沖縄県石垣市フサキ239
Function result: {
  "weather": {
    "error": "座標を取得できませんでした"
  },
  "spots": {
    "location": "石垣島",
    "spots": {
      "観光スポット": [
        {
          "名前": "川平湾",
          "説明": "美しい青い海と白い砂浜が広がる人気のビーチ。シュノーケリングやカヤックを楽しむことができます。"
        },
        {
          "名前": "米原の浜",
          "説明": "透明度の高い海とサンゴ礁が魅力のビーチで、海水浴や海のアクティビティに最適です。"
        },
        {
          "名前": "石垣島鍾乳洞",
          "説明": "神秘的な洞窟で、自然が作り出した美しい鍾乳石を観ることができるスポット。"
        },
        {
          "名前": "平久保崎",
          "説明": "石垣島の最北端にある灯台で、素晴らしい海の景色を楽しめるビューポイント。"
        },
        {
          "名前": "竹富島",
          "説明": "伝統的な沖縄の風景が広がる小さな島で、レンタサイクルでの移動が人気。"
        },
        {
          "名前": "南の島の家",
          "説明": "伝統的な沖縄の建物を見学できる文化体験施設。地元の文化に触れられるスポット。"
        }
      ],
      "ナイトライフ": [
        {
          "名前": "石垣島夜市",
          "説明": "地元の食材や手作りの品が並ぶ市場で、夜の散策を楽しむことができる。"
        },
        {
          "名前": "Bar Yamada",
          "説明": "リラックスした雰囲気の中で地元のビールやカクテルを楽しむことができるバー。"
        },
        {
          "名前": "Karaoke Bar VIVO",
          "説明": "カラオケを楽しむことができるバーで、地元の人々と交流できる場所。"
        },
        {
          "名前": "The Beach Bar",
          "説明": "海を見ながらドリンクを楽しめるビーチフロントのバー。日が沈む景色が美しい。"
        },
        {
          "名前": "スナックひまわり",
          "説明": "アットホームな雰囲気で、地元の人と楽しむ日本酒や地元料理が味わえるスナックバー。"
        },
        {
          "名前": "シーサイド居酒屋",
          "説明": "海沿いにある居酒屋で、地元の新鮮な海産物を楽しむことができる。"
        }
      ],
      "地元料理": [
        {
          "名前": "八重山そば",
          "説明": "石垣島名物のそばで、豚肉やソーキが乗ったあっさりとしたスープが特徴的。"
        },
        {
          "名前": "石垣牛",
          "説明": "高品質な和牛として知られる石垣牛のステーキや焼肉が楽しめる。"
        },
        {
          "名前": "タコライス",
          "説明": "地元のスタイルでアレンジされたメキシコ料理で、ご飯の上にタコスの具が乗った料理。"
        },
        {
          "名前": "島豆腐",
          "説明": "地元の大豆を使った手作りの豆腐で、しっかりとした味わいが特徴。"
        },
        {
          "名前": "ゴーヤーチャンプルー",
          "説明": "沖縄の代表的な料理の一つで、苦瓜と豚肉、豆腐を使った炒め物。"
        }
      ]
    }
  },
  "arrival_time": "2025-10-15T00:00:00",
  "departure_time": "2025-10-20T00:00:00",
  "hotel": {
    "name": "フサキビーチリゾート",
    "address": "沖縄県石垣市フサキ239",
    "lat": 24.3753,
    "lon": 124.2265,
    "match_score": 1.0,
    "distance_km": 0.0,
    "final_score": 1.0
  }
}

💡 旅行プラン回答:
 ### 石垣島 5日間の旅行プラン

#### Day 1: 2025年10月15日（水）
- **天気**: 晴れ時々曇り（気温: 28℃）
- **服装アドバイス**: 軽装で、帽子やサングラスを持参してください。

**ホテル出発**: フサキビーチリゾート

- **午前**: 到着後、ホテルにチェックイン。リラックスして荷物を整理。
  
- **午後**: ホテルのプライベートビーチで海水浴を楽しむ。

- **夜**: 
  - **ナイトライフ**: 石垣島夜市で地元の食材や手作り品を見ながら散策。
  - **地元料理**: 八重山そばを提供するレストランで夕食。

**ホテルに戻る**: フサキビーチリゾート

---

#### Day 2: 2025年10月16日（木）
- **天気**: 晴れ（気温: 29℃）
- **服装アドバイス**: 水着の下に軽やかな服を着用し、サンダルを忘れずに。

**ホテル出発**: フサキビーチリゾート

- **午前**: 川平湾でシュノーケリング体験。

- **午後**: 米原の浜で海水浴を楽しみ、ビーチでのんびり過ごす。

- **夜**: 
  - **ナイトライフ**: The Beach Bar で海を眺めながらドリンクを楽しむ。
  - **地元料理**: 石垣牛のステーキを味わうディナー。

**ホテルに戻る**: フサキビーチリゾート

---

#### Day 3: 2025年10月17日（金）
- **天気**: 曇り時々晴れ（気温: 27℃）
- **服装アドバイス**: 軽やかな長袖のシャツと短パン。

**ホテル出発**: フサキビーチリゾート

- **午前**: 石垣島鍾乳洞の見学。自然の神秘を堪能。

- **午後**: 平久保崎を訪れ、絶景のビューポイントで写真撮影。

- **夜**: 
  - **ナイトライフ**: Bar Yamadaで地元のビールを楽しむ。
  - **地元料理**: ゴーヤーチャンプルーを楽しむディナー。

**ホテルに戻る**: フサキビーチリゾート

---

#### Day 4: 2025年10月18日（土）
- **天気**: 晴れ（気温: 30℃）
- **服装アドバイス**: 薄いドレスやショーツで、休息できる服装。

**ホテル出発**: フサキビーチリゾート

- **午前**: 竹富島へレンタサイクルで観光。美しい伝統的な風景を楽しむ。

- **午後**: 南の島の家で沖縄の文化体験。

- **夜**: 
  - **ナイトライフ**: Karaoke Bar VIVOで地元の人々と交流。
  - **地元料理**: タコライスを味わうディナー。

**ホテルに戻る**: フサキビーチリゾート

---

#### Day 5: 2025年10月19日（日）
- **天気**: 曇り時々晴れ（気温: 26℃）
- **服装アドバイス**: 滞在中に快適な服装。

**ホテル出発**: フサキビーチリゾート

- **午前**: ホテルのビーチでのんびり過ごすか、スパを体験。

- **午後**: チェックアウト後、空港に移動。

- **出発準備**: フライトの搭乗1時間前にチェックインを済ませます。

---

### 持ち物リスト
- 水着
- サングラス
- 日焼け止め
- 帽子
- 薄手の長袖シャツ
- 短パン・スカート
- スニーカーまたはサンダル
- モバイルバッテリー
- カメラ
- ポケットティッシュ
- 折りたたみエコバッグ
- 洗面具一式

これで、石垣島での素晴らしい5日間の旅行が始まります！楽しんできてください！
```
```

